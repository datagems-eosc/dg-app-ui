services:
  frontend:
    build:
      context: .
      args:
        NEXT_PUBLIC_BASE_PATH: /ui
    ports:
      - "${FRONTEND_PORT:-3000}:3000"
    environment:
      # === Core settings ===
      - NODE_ENV=production
      - NEXT_TELEMETRY_DISABLED=1

      # === PUBLIC_* variables (exposed to browser via window.__env) ===
      - PUBLIC_APP_NAME=DataGEMS
      - PUBLIC_APP_BASE_URL=http://localhost:${FRONTEND_PORT:-3000}
      - PUBLIC_DATAGEMS_API_BASE_URL=https://datagems-dev.scayle.es

      # === Server-only variables (NOT exposed to browser) ===
      - KEYCLOAK_AUTH_GRAND_TYPE=PKCE
      - KEYCLOAK_CLIENT_ID=dg-app-ui
      - KEYCLOAK_CLIENT_SECRET="" # (empty string, not used)
      - KEYCLOAK_ISSUER=https://datagems-dev.scayle.es/oauth/realms/dev
      - NEXTAUTH_URL=http://localhost:${FRONTEND_PORT:-3000}
      - NEXTAUTH_SECRET=your-secret-key-here-change-in-production
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/healthz"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s